import { api } from '@/api';
import { useQuery } from '@tanstack/react-query';

const LOCAL_STORAGE_CART_KEY = 'guestCart';

export const useCart = (userId?: string) => {
	const queryKey = ['cart', userId ?? 'guest'];
	const { data, isLoading: isCartLoading } = useQuery({
		queryKey,
		queryFn: async () => {
			console.log('userId logs 9000000', userId);

			if (!userId) {
				const guestCart = localStorage.getItem(LOCAL_STORAGE_CART_KEY);
				console.log(
					'returning guestCart logs 9000000',
					JSON.parse(guestCart ?? '{}')
				);
				return guestCart
					? JSON.parse(guestCart)
					: { cartItems: [], totalItems: 0 };
			}

			const response = await api.cart.getCartByCustomerId();
			console.log('response logs 9000000', response);

			if (response.status === 404) {
				const response = await api.cart.create({});
				return response?.data?.data;
			}

			return response?.data?.data;
		},
		staleTime: 1000 * 60 * 5,
	});

	return { queryKey, cart: data, isCartLoading };
};
